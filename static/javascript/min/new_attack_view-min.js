window.NewAttackView=Backbone.View.extend({initialize:function(){this.render()},el:$("#add-attack-popup"),popupBackgroundEl:$("#add-attack-popup"),popupEl:$("#add-attack-popup > .popup"),events:{"click #submit-button":"addAttack","click #cancel-button":"cancel","click .fa-close":"cancel",click:"closePopup"},attackViewContainer:$("#add-attack-view-container"),render:function(){return this.attackView=new AttackView,this.attackView.attributes.submit_button="Update",this.attackView.attributes.show_cancel=!0,this.attackView.attributes.show_delete=!0,this.attackViewContainer.empty(),this.attackViewContainer.append(this.attackView.render().$el),this.deleteButton=this.$el.find("#delete-button"),this},show:function(t){this.model=t,this.popupBackgroundEl.velocity({backgroundColor:["#000000","#000000"],backgroundColorAlpha:[.6,0]},{duration:300,display:"block"}),this.popupEl.velocity({opacity:1,top:[60,200],scaleX:[1,.8],scaleY:[1,.8]},{display:"block",duration:300,easing:[.175,.885,.32,1.275]}),this.attackView.setModel(t),this.deleteButton.removeClass("delete-sure")},closePopup:function(t){var e=$(t.target);e.hasClass("popup-background")&&this.hide()},hide:function(){this.popupBackgroundEl.velocity("reverse",{display:"none"}),this.popupEl.velocity("reverse",{display:"none"})},editAttack:function(t){t.preventDefault();var e=this,a=this.attackView.getStarted(),i=this.attackView.getEnded(),d=this.attackView.commentEL.val();this.attackView.submitButtonEl.hasClass("pure-button-disabled")||(this.attackView.submitButtonEl.addClass("pure-button-disabled"),this.attackView.addMessageLabelEl.html("Saving attack..."),$.ajax({type:"POST",url:"/report/edit",data:{id:this.model.get("id"),started:a,ended:i,comment:d}}).done(function(t){e.attackView.submitButtonEl.removeClass("pure-button-disabled"),e.attackView.addMessageLabelEl.html("Attack updated."),_.delay(function(){e.hide(),e.attackView.addMessageLabelEl.html("")},100);var a=(e.attackView.getEndedDate()-e.attackView.getStartedDate())/1e3;e.attackView.getStarted()!=e.model.get("start")||a!=e.model.get("duration")?(App.dataChanged(),App.refreshData()):e.model.set({comment:d})}).fail(function(t){e.attackView.addMessageLabelEl.html("Failed to update attack."),e.attackView.submitButtonEl.removeClass("pure-button-disabled")}))},cancel:function(t){t.preventDefault(),this.hide()},deleteAttack:function(t){t.preventDefault();var e=this;this.deleteButton.hasClass("delete-sure")?this.deleteButton.hasClass("pure-button-disabled")||(this.deleteButton.addClass("pure-button-disabled"),this.attackView.addMessageLabelEl.html("Removing attack..."),$.ajax({type:"POST",url:"/report/delete",data:{id:this.model.get("id")}}).done(function(t){e.deleteButton.removeClass("pure-button-disabled"),e.attackView.addMessageLabelEl.html("Attack deleted."),_.delay(function(){e.hide(),e.attackView.addMessageLabelEl.html("")},600),App.dataChanged(),App.refreshData()}).fail(function(t){e.attackView.addMessageLabelEl.html("Failed to delete attack."),e.deleteButton.removeClass("pure-button-disabled")})):App.example||(this.deleteButton.addClass("delete-sure"),_.delay(function(){e.deleteButton.removeClass("delete-sure")},4e3))}});